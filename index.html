<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Student Budget Buddy</title>
<style>
  body{margin:0;font-family:"Poppins",sans-serif;background:linear-gradient(135deg,#d2e9f7,#f8faff);color:#333}
  header{background:#2196f3;color:#fff;text-align:center;padding:25px 10px;box-shadow:0 2px 10px rgba(0,0,0,.2)}
  nav{background:#1976d2;display:flex;justify-content:center;gap:30px;padding:10px}
  nav a{color:#fff;text-decoration:none;font-weight:500}
  nav a:hover{text-decoration:underline}
  .container{padding:40px;text-align:center}
  .container img{width:80%;max-width:500px;border-radius:12px;margin-top:20px;box-shadow:0 4px 15px rgba(0,0,0,.1)}
  button{background:#2196f3;color:#fff;border:none;padding:10px 25px;border-radius:8px;margin-top:25px;cursor:pointer}
  button:hover{background:#1976d2}
  footer{background:#f1f1f1;text-align:center;padding:15px;font-size:14px;color:#555}

/* Chat widget */
#ai-widget{position:fixed;bottom:20px;right:20px;width:340px;background:#fff;border-radius:14px;box-shadow:0 6px 14px rgba(0,0,0,.25);display:flex;flex-direction:column;overflow:hidden;font-family:'Segoe UI',Arial,sans-serif;z-index:9999}
#ai-header{background:linear-gradient(90deg,#4b7bec,#3867d6);color:#fff;padding:.75rem 1rem;font-weight:600;cursor:pointer;text-align:center}
#ai-chat{display:none;flex-direction:column;max-height:360px;overflow-y:auto;padding:.75rem;gap:.5rem;scroll-behavior:smooth}
#ai-input-container{display:none;border-top:1px solid #ddd;background:#fafafa;align-items:center;padding:.5rem;gap:.5rem}
#ai-user-input{flex:1;padding:.5rem .8rem;border:1px solid #ccc;border-radius:25px;outline:none}
#ai-send-btn{padding:.4rem 1rem;background:#4b7bec;color:#fff;border:none;border-radius:25px;cursor:pointer;font-weight:500}
#ai-send-btn:hover{background:#3867d6}

/* message styles */
.chat-msg{padding:.5rem .8rem;border-radius:14px;max-width:80%;word-break:break-word;margin-bottom:6px}
.chat-user{align-self:flex-end;background:#4b7bec;color:#fff}
.chat-bot{align-self:flex-start;background:#e9e9ee;color:#000}

/* typing dots */
.typing-dots{display:flex;gap:6px;align-self:flex-start}
.typing-dots span{width:6px;height:6px;border-radius:50%;background:#999;animation:blink 1s infinite}
.typing-dots span:nth-child(2){animation-delay:.2s}
.typing-dots span:nth-child(3){animation-delay:.4s}
@keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}

/* responsive */
@media (max-width:600px){#ai-widget{width:90%;right:5%;bottom:10px}}
</style>
</head>
<body>

<header>
  <h1>🎓 Student Budget Buddy</h1>
  <p>Your personal expense tracker for school & college life</p>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="tracker.html">Expense Tracker</a>
  <a href="tips.html">Money Tips</a>
</nav>

<div class="container">
  <h2>Welcome!</h2>
  <p>Manage your pocket money smartly, track your monthly spending, and learn financial discipline early!</p>
  <img src="https://static.wixstatic.com/media/bc172e_acb81131c2954d40af6884aeb2a2b130~mv2.jpg/v1/fill/w_740,h_440,al_c,q_80,enc_auto/bc172e_acb81131c2954d40af6884aeb2a2b130~mv2.jpg" alt="Student budgeting">
  <br>
  <button onclick="location.href='tracker.html'">Start Tracking Now</button>
</div>

<!-- Chat widget -->
<div id="ai-widget" aria-live="polite">
  <div id="ai-header">💬 Expense AI</div>
  <div id="ai-chat" role="log" aria-atomic="false"></div>
  <div id="ai-input-container">
    <input id="ai-user-input" aria-label="Message" placeholder="Type a message..." />
    <button id="ai-send-btn">Send</button>
  </div>
</div>

<footer>2025 Student Budget Buddy | Made for students, by students 💸</footer>

<script>
/* ---------------------------
   Local rule-based chatbot
   --------------------------- */
const header = document.getElementById('ai-header');
const chat = document.getElementById('ai-chat');
const inputContainer = document.getElementById('ai-input-container');
const input = document.getElementById('ai-user-input');
const sendBtn = document.getElementById('ai-send-btn');

// show saved chat if present
const STORAGE_KEY = 'expense_ai_chat_v1';
if (localStorage.getItem(STORAGE_KEY)) {
  chat.innerHTML = localStorage.getItem(STORAGE_KEY);
  chat.style.display = 'flex';
  inputContainer.style.display = 'flex';
}

// toggle widget
header.addEventListener('click', () => {
  const open = chat.style.display === 'flex';
  chat.style.display = open ? 'none' : 'flex';
  inputContainer.style.display = open ? 'none' : 'flex';
  if (!open) input.focus();
});

// append a message
function appendMessage(text, sender='bot') {
  const div = document.createElement('div');
  div.className = 'chat-msg ' + (sender === 'user' ? 'chat-user' : 'chat-bot');
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  localStorage.setItem(STORAGE_KEY, chat.innerHTML);
}

// show typing dots
function showTyping() {
  hideTyping();
  const d = document.createElement('div');
  d.id = 'ai-typing';
  d.className = 'typing-dots';
  d.innerHTML = '<span></span><span></span><span></span>';
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}
function hideTyping() {
  const ex = document.getElementById('ai-typing');
  if (ex) ex.remove();
}

// simple local reply logic (expandable)
function localBotReply(userText) {
  const t = userText.toLowerCase();

  // quick numeric parsing for budget questions
  const moneyMatch = userText.match(/(\d+(\.\d+)?)/);
  if (t.includes('hello') || t.includes('hi')) {
    return "Hi! I'm Expense AI — tell me your monthly pocket money or ask for saving tips.";
  }
  if (t.includes('save') || t.includes('saving')) {
    return "Try the 50/30/20 rule: 50% needs, 30% wants, 20% savings. Want me to calculate based on your amount?";
  }
  if (t.includes('tips') || t.includes('advice')) {
    return "Small tips: track daily snacks, set a weekly allowance, and avoid impulse buys. I can set reminders if you want.";
  }
  if (t.includes('calculate') || t.includes('how much') || t.includes('budget')) {
    if (moneyMatch) {
      const amount = parseFloat(moneyMatch[1]);
      const needs = (amount * 0.5).toFixed(2);
      const wants = (amount * 0.3).toFixed(2);
      const save = (amount * 0.2).toFixed(2);
      return `From ₹${amount}: Needs ≈ ₹${needs}, Wants ≈ ₹${wants}, Savings ≈ ₹${save} (50/30/20).`;
    } else {
      return "Please tell me how much money you get per month (for example: '₹2000' or '2000').";
    }
  }
  if (t.includes('bye') || t.includes('thanks') || t.includes('thank')) {
    return "You're welcome! Come back any time for budgeting help 😊";
  }

  // fallback small talk + random helpful fallback
  const fallbackAnswers = [
    "I can help with tracking, simple budgeting calculations, and saving tips. Try 'calculate 1500' or 'saving tips'.",
    "Try asking: 'How should I split ₹2000 for the month?' or 'Give me saving tips for students.'",
    "Tell me your monthly pocket money and I'll suggest a simple budget breakdown."
  ];
  return fallbackAnswers[Math.floor(Math.random() * fallbackAnswers.length)];
}

// simulate async response (typing)
async function handleLocalReply(text) {
  showTyping();
  // add a brief fake processing delay
  await new Promise(r => setTimeout(r, 700 + Math.random() * 800));
  hideTyping();
  const reply = localBotReply(text);
  appendMessage(reply, 'bot');
}

// send message
let sending = false;
async function sendMessage() {
  if (sending) return;
  const text = input.value.trim();
  if (!text) return;
  sending = true;
  appendMessage(text, 'user');
  input.value = '';
  // Local reply
  try {
    await handleLocalReply(text);
  } catch (err) {
    hideTyping();
    appendMessage("⚠️ Something went wrong locally. Check console.", 'bot');
    console.error('Local bot error:', err);
  }
  sending = false;
}

// keyboard + button
sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendMessage();
});

// quick debug helper for you (visible in console)
console.log('Expense AI widget initialized — local mode (no external API).');
</script>
</body>
</html>
