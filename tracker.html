
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Student Budget Buddy - Track your expenses and manage pocket money smartly.">
<title>Expense Tracker | Student Budget Buddy</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, setDoc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDwmJ-6PWeD6x-5rjiWywsFMDlEFSSCsgc",
  authDomain: "student-budget-tracker-ac367.firebaseapp.com",
  projectId: "student-budget-tracker-ac367",
  storageBucket: "student-budget-tracker-ac367.appspot.com",
  messagingSenderId: "367537585165",
  appId: "1:367537585165:web:cb945c4d12cad3914ee944"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Authentication function
async function authenticate(email, password) {
  try {
    await signInWithEmailAndPassword(auth, email, password);
    alert("Login successful!");
    document.getElementById('loginModal').style.display = 'none';
    loadExpenses();
  } catch (loginErr) {
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("Account created successfully!");
      document.getElementById('loginModal').style.display = 'none';
      loadExpenses();
    } catch (signErr) {
      alert(signErr.message);
    }
  }
}
window.authenticate = authenticate;

// Track auth state
onAuthStateChanged(auth, user => {
  if(user){
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('userEmail').innerText = user.email;
    loadExpenses();
  } else {
    document.getElementById('loginBtn').style.display = 'inline-block';
    document.getElementById('userEmail').innerText = '';
    expenses = [];
    renderTable();
  }
});

let expenses = [];
let budget = 0;
</script>

<style>
body { font-family: 'Poppins', sans-serif; margin:0; background: linear-gradient(135deg,#d2f7d2,#a0e9a0); color:#333; }
header { background:#00a651; color:white; text-align:center; padding:20px; box-shadow:0 3px 10px rgba(0,0,0,0.2); }
header h1{ margin:0; }
nav { background:#007f3f; display:flex; flex-wrap:wrap; justify-content:center; gap:15px; padding:10px; }
nav a, #loginBtn{ color:white; text-decoration:none; padding:8px 12px; border-radius:5px; cursor:pointer; transition:0.3s; }
nav a:hover, #loginBtn:hover{ background: rgba(255,255,255,0.2); }
.container{ max-width:900px; margin:20px auto; background:white; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.15); }
input, select, button{ padding:10px; border-radius:6px; border:1px solid #ccc; margin-top:10px; transition:0.3s; width:100%; max-width:250px; display:block; }
button{ background:#00a651; color:white; border:none; cursor:pointer; }
button:hover{ background:#007f3f; }
table{ width:100%; border-collapse: collapse; margin-top:20px; overflow-x:auto; display:block; }
th, td{ padding:10px; border-bottom:1px solid #ddd; text-align:center; }
th{ background:#c4f0c4; cursor:pointer; }
tr:hover{ background:#e5ffe5; }
.delete-btn, .edit-btn{ padding:6px 10px; border:none; border-radius:5px; cursor:pointer; color:white; }
.edit-btn{ background:#4caf50; } .edit-btn:hover{background:#388e3c;} .delete-btn{ background:#f44336; } .delete-btn:hover{background:#c62828;}
.summary{ margin-top:15px; font-weight:bold; text-align:right; }
.budget-warning{ color:red; font-size:1.1em; margin-top:10px; display:none; }
.chart-container{ margin-top:20px; max-width: 100%; }
.video-container{ position:relative; padding-bottom:56.25%; height:0; overflow:hidden; border-radius:12px; margin:20px auto; max-width:800px; box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.video-container iframe{ position:absolute; top:0; left:0; width:100%; height:100%; border:0; }
.tip-popup{ position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#fff; border-radius:12px; padding:12px 20px; box-shadow:0 5px 15px rgba(0,0,0,0.3); display:flex; align-items:center; gap:10px; font-weight:500; z-index:9999; animation: slideUp 0.5s ease; }
@keyframes fadeIn{from{opacity:0;} to{opacity:1;}} @keyframes slideUp{from{transform:translateY(20px) translateX(-50%); opacity:0;} to{transform:translateY(0) translateX(-50%); opacity:1;}}
@media(max-width:600px){ header h1{font-size:1.5em;} nav a{font-size:0.9em;padding:6px 8px;} .container{padding:15px;margin:15px;} table, th, td{font-size:0.85em;} }
</style>
</head>

<body>

<header>
<h1>Expense Tracker</h1>
<div id="userEmail"></div>
</header>

<nav>
<a href="index.html">Home</a>
<a href="tracker.html">Expense Tracker</a>
<a href="tips.html">Money Tips</a>
<a href="about.html">About Us</a>
<div id="loginBtn" onclick="document.getElementById('loginModal').style.display='flex'">Login / Sign Up</div>
</nav>

<div class="container">
<h2>Add a New Expense</h2>
<input type="text" id="desc" placeholder="Description">
<input type="number" id="amount" placeholder="Amount â‚¹" min="0" step="0.01">
<select id="category" onchange="checkOthers(this.value)">
  <option value="Food">Food</option>
  <option value="Transport">Transport</option>
  <option value="Books">Books</option>
  <option value="Leisure">Leisure</option>
  <option value="Others">Others</option>
</select>
<input type="text" id="otherCategory" placeholder="Specify if Others" style="display:none;">
<input type="date" id="date">
<button onclick="addExpense()">Add Expense</button>

<h3>Expense List</h3>
<input type="text" id="search" placeholder="Search expenses...">
<button onclick="searchExpenses()">Search</button>

<table id="expenseTable">
<thead>
<tr>
<th onclick="sortTable(0)">Description</th>
<th onclick="sortTable(1)">Category</th>
<th onclick="sortTable(2)">Amount</th>
<th onclick="sortTable(3)">Date</th>
<th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="summary">
Total Spent: â‚¹<span id="total">0</span>
<span id="budget-status"></span>
</div>
<div class="budget-warning" id="budget-warning"></div>

<h3>Budget Settings</h3>
<input type="number" id="budget" placeholder="Set Monthly Budget â‚¹">
<button onclick="setBudgetHandler()">Set Budget</button>

<h3>Expense Breakdown</h3>
<div class="chart-container">
<canvas id="expenseChart"></canvas>
</div>

<div class="video-container">
<iframe src="https://www.youtube.com/embed/MXCvtC0HqLE?start=478&autoplay=0" title="Money Management for Students" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>

<!-- Login Modal -->
<div id="loginModal">
<div id="loginContent">
<h2>Login or Sign Up</h2>
<input type="email" id="email" placeholder="Email" required>
<input type="password" id="password" placeholder="Password" required>
<br>
<button onclick="authenticate(document.getElementById('email').value, document.getElementById('password').value)">Continue</button>
</div>
</div>
<script type="module">
import { collection, addDoc, getDocs, doc, deleteDoc, setDoc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

// Firestore reference
const expensesCol = collection(db, "expenses");

// Show/hide Other category input
function checkOthers(value){
  document.getElementById("otherCategory").style.display = (value === "Others") ? "block" : "none";
}

// Add expense
async function addExpense(){
  const user = auth.currentUser;
  if(!user){ alert("Login first!"); return; }

  const desc = document.getElementById("desc").value.trim();
  let category = document.getElementById("category").value;
  if(category === "Others") category = document.getElementById("otherCategory").value.trim() || "Others";
  const amount = parseFloat(document.getElementById("amount").value);
  const date = document.getElementById("date").value;

  if(!desc || !amount || !date){
    alert("Please fill all fields!"); return;
  }

  try{
    await addDoc(expensesCol, {
      uid: user.uid,
      desc, category, amount, date
    });
    alert("Expense added!");
    loadExpenses();
    document.getElementById("desc").value="";
    document.getElementById("amount").value="";
    document.getElementById("date").value="";
    document.getElementById("otherCategory").value="";
  }catch(err){
    alert("Error adding expense: "+err.message);
  }
}

// Load expenses
async function loadExpenses(){
  const user = auth.currentUser;
  if(!user) return;
  expenses = [];
  const snapshot = await getDocs(expensesCol);
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    if(data.uid === user.uid){
      expenses.push({...data, id: docSnap.id});
    }
  });
  renderTable();
}

// Delete expense
async function deleteExpense(id){
  if(confirm("Delete this expense?")){
    await deleteDoc(doc(db, "expenses", id));
    loadExpenses();
  }
}

// Edit expense
function editExpense(id){
  const exp = expenses.find(e=>e.id===id);
  if(!exp) return;
  document.getElementById("desc").value = exp.desc;
  document.getElementById("amount").value = exp.amount;
  document.getElementById("date").value = exp.date;
  if(exp.category && ["Food","Transport","Books","Leisure"].includes(exp.category)){
    document.getElementById("category").value = exp.category;
    document.getElementById("otherCategory").style.display = "none";
  } else{
    document.getElementById("category").value = "Others";
    document.getElementById("otherCategory").style.display = "block";
    document.getElementById("otherCategory").value = exp.category;
  }
  deleteExpense(id); // remove old, will re-add on submit
}

// Render table
function renderTable(){
  const tbody = document.querySelector("#expenseTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  expenses.forEach(e=>{
    total+=e.amount;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${e.desc}</td>
      <td>${e.category}</td>
      <td>â‚¹${e.amount.toFixed(2)}</td>
      <td>${e.date}</td>
      <td>
        <button class="edit-btn" onclick="editExpense('${e.id}')">Edit</button>
        <button class="delete-btn" onclick="deleteExpense('${e.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total").innerText = total.toFixed(2);

  // Budget warning
  if(budget>0 && total>budget){
    document.getElementById("budget-warning").style.display="block";
    document.getElementById("budget-warning").innerText="âš ï¸ You have exceeded your budget!";
  }else{
    document.getElementById("budget-warning").style.display="none";
  }

  updateChart();
}

// Set budget
function setBudgetHandler(){
  const val = parseFloat(document.getElementById("budget").value);
  if(!isNaN(val) && val>0){ budget=val; alert("Budget set to â‚¹"+budget); renderTable(); }
  else alert("Invalid budget!");
}

// Search
function searchExpenses(){
  const term = document.getElementById("search").value.trim().toLowerCase();
  const tbody = document.querySelector("#expenseTable tbody");
  tbody.innerHTML="";
  let total = 0;
  expenses.filter(e=>e.desc.toLowerCase().includes(term) || e.category.toLowerCase().includes(term))
  .forEach(e=>{
    total+=e.amount;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${e.desc}</td>
      <td>${e.category}</td>
      <td>â‚¹${e.amount.toFixed(2)}</td>
      <td>${e.date}</td>
      <td>
        <button class="edit-btn" onclick="editExpense('${e.id}')">Edit</button>
        <button class="delete-btn" onclick="deleteExpense('${e.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("total").innerText = total.toFixed(2);
}

// Sorting
function sortTable(n){
  const tbody = document.querySelector("#expenseTable tbody");
  const rows = Array.from(tbody.rows);
  let asc = tbody.getAttribute("data-sort-dir") !== "asc";
  rows.sort((a,b)=>{
    let x = a.cells[n].innerText.toLowerCase(), y = b.cells[n].innerText.toLowerCase();
    if(n===2) { x=parseFloat(x.replace('â‚¹','')); y=parseFloat(y.replace('â‚¹','')); }
    return (x<y?-1:1)*(asc?1:-1);
  });
  tbody.innerHTML="";
  rows.forEach(r=>tbody.appendChild(r));
  tbody.setAttribute("data-sort-dir", asc?"asc":"desc");
}

// ChartJS
let chart;
function updateChart(){
  const catTotals = {};
  expenses.forEach(e=>{ catTotals[e.category]=(catTotals[e.category]||0)+e.amount; });
  const labels = Object.keys(catTotals);
  const data = Object.values(catTotals);
  const ctx = document.getElementById("expenseChart").getContext("2d");
  if(chart) chart.destroy();
  chart = new Chart(ctx,{
    type:"pie",
    data:{labels, datasets:[{data, backgroundColor:["#4caf50","#00a651","#8bc34a","#c8e6c9","#aed581"]}]},
    options:{plugins:{legend:{position:"bottom"}}}
  });
}

// AI Responses
const aiResponses = {
  "food":["ğŸ” Meal prep saves time & money!","ğŸ¥— Try home-cooked meals daily.","â˜• Avoid takeaways; save cash."],
  "transport":["ğŸšŒ Student passes help.","ğŸš´ Walk or bike!","ğŸš— Carpool to save money."],
  "books":["ğŸ“š Use library first.","ğŸ’¡ Second-hand books save money.","ğŸ“ Rent textbooks."],
  "leisure":["ğŸ¬ Limit streaming/movie nights.","ğŸ® Free entertainment options.","ğŸ§© Plan leisure spending."],
  "others":["ğŸ’­ Review misc expenses.","ğŸ’¸ Track carefully.","ğŸ“Š Small items add up."]
};

// AI popup
function appendMessage(sender,message){
  const log = document.getElementById("ai-chat-log");
  const div = document.createElement("div");
  div.style.marginBottom="6px";
  div.innerHTML=`<strong>${sender}:</strong> ${message}`;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

// Chatbot
function askExpenseAI(){
  const input = document.getElementById("ai-chat-input");
  const query = input.value.trim().toLowerCase();
  if(!query) return;
  appendMessage("You", input.value);
  input.value="";

  let response="ğŸ¤– Sorry, I didn't understand. Ask about food, transport, books, leisure, others, or budget.";

  if(query.includes("budget")||query.includes("50/30/20")||query.includes("save")){
    const totalBudget = parseFloat(prompt("Enter your monthly budget amount â‚¹:"));
    if(!isNaN(totalBudget)&&totalBudget>0){
      const needs=(totalBudget*0.5).toFixed(2);
      const wants=(totalBudget*0.3).toFixed(2);
      const savings=(totalBudget*0.2).toFixed(2);
      response=`ğŸ¤– Using 50/30/20 rule for â‚¹${totalBudget}: ğŸ  Needs(50%):â‚¹${needs} ğŸ‰ Wants(30%):â‚¹${wants} ğŸ’° Savings(20%):â‚¹${savings}`;
    }else{ response="ğŸ¤– Invalid budget amount!"; }
  } else if(query.includes("food")) response="ğŸ¤– "+aiResponses.food[Math.floor(Math.random()*aiResponses.food.length)];
  else if(query.includes("transport")) response="ğŸ¤– "+aiResponses.transport[Math.floor(Math.random()*aiResponses.transport.length)];
  else if(query.includes("book")) response="ğŸ¤– "+aiResponses.books[Math.floor(Math.random()*aiResponses.books.length)];
  else if(query.includes("leisure")||query.includes("fun")) response="ğŸ¤– "+aiResponses.leisure[Math.floor(Math.random()*aiResponses.leisure.length)];
  else if(query.includes("other")) response="ğŸ¤– "+aiResponses.others[Math.floor(Math.random()*aiResponses.others.length)];

  appendMessage("Expense AI", response);
}
</script>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<footer>
2025 Student Budget Buddy | Made for students ğŸ’¸ Contact us at studentbudgetbuddyhelp@gmail.com
</footer>
</body>
</html>
