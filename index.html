<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Student Budget Buddy helps students track expenses, manage pocket money, and get smart financial advice.">
<title>Student Budget Buddy</title>

<!-- Google Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDwmJ-6PWeD6x-5rjiWywsFMDlEFSSCsgc",
  authDomain: "student-budget-tracker-ac367.firebaseapp.com",
  projectId: "student-budget-tracker-ac367",
  storageBucket: "student-budget-tracker-ac367.appspot.com",
  messagingSenderId: "367537585165",
  appId: "1:367537585165:web:cb945c4d12cad3914ee944"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

async function authenticate(email, password) {
  try {
    await signInWithEmailAndPassword(auth, email, password);
    alert("Login successful!");
    document.getElementById('loginModal').style.display = 'none';
  } catch (loginErr) {
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("Account created successfully!");
      document.getElementById('loginModal').style.display = 'none';
    } catch (signErr) {
      alert(signErr.message);
    }
  }
}
window.authenticate = authenticate;

onAuthStateChanged(auth, user => {
  if(user){
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('userEmail').innerText = user.email;
  } else {
    document.getElementById('loginBtn').style.display = 'inline-block';
    document.getElementById('userEmail').innerText = '';
  }
});
</script>

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #d2f5d2, #e6ffe6);
  color: #333;
}
header {
  background: #2e7d32;
  color: #fff;
  text-align: center;
  padding: 30px 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  position: relative;
}
header h1 { font-size: 2em; margin-bottom:5px; }
header p { font-size: 1.1em; }
#userEmail { position: absolute; top: 10px; right: 20px; font-size: 0.9em; color: #fff; }

nav {
  background: #1b5e20;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 15px;
  padding: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
nav a, #loginBtn {
  color: white;
  text-decoration: none;
  font-weight: 500;
  padding: 8px 15px;
  border-radius: 6px;
  transition: 0.3s ease;
  cursor: pointer;
}
nav a:hover, #loginBtn:hover { background: rgba(255,255,255,0.15); }

.container {
  text-align: center;
  padding: 40px 20px;
  max-width: 900px;
  margin: 0 auto;
}

.btn {
  background: #00a651;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px 25px;
  margin: 10px 5px;
  cursor: pointer;
  font-size: 1em;
  transition: 0.3s ease;
}
.btn:hover { background: #007f3f; }

/* Login Modal */
#loginModal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
}
#loginContent {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  text-align: center;
}
#loginContent input {
  width: 80%;
  padding: 10px;
  margin: 10px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
}
#loginContent button {
  padding: 10px 20px;
  margin-top: 10px;
  border: none;
  border-radius: 6px;
  background: #43a047;
  color: white;
  cursor: pointer;
  transition: 0.3s ease;
}
#loginContent button:hover { background:#2e7d32; }

/* AI widget */
#aiWidget {
  background: #fff;
  padding: 20px;
  margin: 25px auto;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  max-width: 900px;
  text-align: left;
}
#aiWidget input, #aiWidget button {
  padding: 10px;
  margin: 5px 0;
  border-radius: 6px;
  border:1px solid #ccc;
}
#aiWidget button {
  background: #00a651;
  color:white;
  border:none;
  cursor:pointer;
}
#aiWidget button:hover { background:#007f3f; }

.video-container{
    position:relative;
    padding-bottom:56.25%;
    height:0;
    overflow:hidden;
    border-radius:12px;
    margin-top:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
.video-container iframe{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}

footer {
  text-align:center;
  padding:10px;
  background:#f1f1f1;
  color:#555;
  font-size:0.9em;
}
</style>
</head>

<body>

<header>
  <h1>üéì Student Budget Buddy</h1>
  <p>Track your spending & manage your pocket money smartly!</p>
  <div id="userEmail"></div>
</header>

<nav>
  <a href="index.html">Home</a>
  <a href="tracker.html">Expense Tracker</a>
  <a href="tips.html">Money Tips</a>
  <a href="https://forms.gle/PkAbSHMgfWDZM2jH8">Feedback</a>
  <a href="about.html">About Us</a>
  <div id="loginBtn" onclick="document.getElementById('loginModal').style.display='flex'">Login / Sign Up</div>
</nav>

<div class="container">
  <h2>Welcome!</h2>
  <p>Manage your pocket money, track expenses, and get AI-powered advice to save better.</p>
  <img src="https://static.wixstatic.com/media/bc172e_acb81131c2954d40af6884aeb2a2b130~mv2.jpg" alt="Student budgeting illustration">

  <div>
    <button class="btn" onclick="location.href='tracker.html'">Start Tracking Now</button>
    <button class="btn" onclick="location.href='tips.html'">View Money Tips</button>
  </div>

  <!-- Expense AI Widget -->
  <div id="aiWidget">
    <h3>Expense AI ü§ñ</h3>
    <p>Ask me about your expenses or get tips!</p>
    <input type="text" id="aiInput" placeholder="Type your question...">
    <button onclick="askAI()">Ask</button>
    <p id="aiResponse" style="margin-top:10px;"></p>
  </div>

  <!-- Video -->
  <h3>Watch this for more tips üé•</h3>
  <div class="video-container">
    <iframe src="https://www.youtube.com/embed/28FMPE2tH80" title="Money management tips for students" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>
</div>

<!-- Login Modal -->
<div id="loginModal">
  <div id="loginContent">
    <h2>Login or Sign Up</h2>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <br>
    <button onclick="authenticate(document.getElementById('email').value, document.getElementById('password').value)">Continue</button>
  </div>
</div>

<script type="module">
// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDwmJ-6PWeD6x-5rjiWywsFMDlEFSSCsgc",
  authDomain: "student-budget-tracker-ac367.firebaseapp.com",
  projectId: "student-budget-tracker-ac367",
  storageBucket: "student-budget-tracker-ac367.appspot.com",
  messagingSenderId: "367537585165",
  appId: "1:367537585165:web:cb945c4d12cad3914ee944"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let expenses = [];
let budget = 0;
let userId = null;
let chartInstance = null;

// ---------------- Authentication ----------------
onAuthStateChanged(auth, user => {
    if (user) {
        userId = user.uid;
        loadExpenses();
        loadBudget();
    } else {
        // Auto-login or create account with dummy email (for demo)
        const email = prompt("Enter your email for tracking:");
        const password = "default123"; // simple password for demo
        signInWithEmailAndPassword(auth, email, password)
            .catch(err => {
                // If user not found, create account
                createUserWithEmailAndPassword(auth, email, password)
                .then(userCred => {
                    userId = userCred.user.uid;
                });
            });
    }
});

// ---------------- Firestore sync ----------------
async function loadExpenses() {
    const expCol = collection(db, "users", userId, "expenses");
    onSnapshot(expCol, snapshot => {
        expenses = [];
        snapshot.forEach(doc => expenses.push({...doc.data(), id: doc.id}));
        renderTable();
    });
}

async function loadBudget() {
    const budgetDoc = doc(db, "users", userId);
    const snap = await getDoc(budgetDoc);
    if (snap.exists()) budget = snap.data().budget || 0;
    document.getElementById("budget").value = budget;
    renderTable();
}

// ---------------- Expense functions ----------------
async function addExpense() {
    const desc = document.getElementById("desc").value.trim();
    const amount = parseFloat(document.getElementById("amount").value);
    let category = document.getElementById("category").value;
    const otherCat = document.getElementById("otherCategory").value.trim();
    if(category==="Others" && otherCat) category = otherCat;
    const date = document.getElementById("date").value || new Date().toISOString().split('T')[0];
    if(!desc || isNaN(amount) || amount <=0){ alert("Enter valid description and positive amount!"); return; }

    const expCol = collection(db, "users", userId, "expenses");
    await setDoc(doc(expCol), {desc, amount, category, date});
    clearForm();
}

function clearForm(){
    document.getElementById("desc").value="";
    document.getElementById("amount").value="";
    document.getElementById("category").value="Food";
    document.getElementById("otherCategory").value="";
    document.getElementById("otherCategory").style.display="none";
    document.getElementById("date").value="";
}

async function deleteExpense(index){
    const id = expenses[index].id;
    await deleteDoc(doc(db, "users", userId, "expenses", id));
}

async function editExpense(index){
    const item = expenses[index];
    const newDesc = prompt("Edit Description:", item.desc);
    const newAmount = parseFloat(prompt("Edit Amount:", item.amount));
    const newCategory = prompt("Edit Category:", item.category);
    const newDate = prompt("Edit Date (YYYY-MM-DD):", item.date);
    if(newDesc && !isNaN(newAmount) && newAmount>0 && newCategory && newDate){
        await setDoc(doc(db, "users", userId, "expenses", item.id), {
            desc:newDesc, amount:newAmount, category:newCategory, date:newDate
        });
    } else alert("Invalid input!");
}

// ---------------- Budget functions ----------------
async function setBudget(){
    budget = parseFloat(document.getElementById("budget").value);
    await setDoc(doc(db, "users", userId), {budget}, {merge:true});
    renderTable();
}

// ---------------- Rendering ----------------
function renderTable(){
    const tbody = document.querySelector("#expenseTable tbody");
    tbody.innerHTML = "";
    let total = 0;
    const catTotals = {};

    expenses.forEach((item,index)=>{
        total+=parseFloat(item.amount);
        catTotals[item.category] = (catTotals[item.category] || 0)+parseFloat(item.amount);
        tbody.innerHTML += `<tr>
            <td>${item.desc}</td>
            <td>${item.category}</td>
            <td>‚Çπ${item.amount.toFixed(2)}</td>
            <td>${item.date}</td>
            <td>
                <button class="edit-btn" onclick="editExpense(${index})">Edit</button>
                <button class="delete-btn" onclick="deleteExpense(${index})">Delete</button>
            </td>
        </tr>`;
    });

    document.getElementById("total").innerText = total.toFixed(2);
    checkBudget(total);
    renderChart(catTotals);
    smartTips(total, catTotals);
}

function sortTable(col){
    expenses.sort((a,b)=>{
        if(col===2) return a.amount-b.amount;
        if(col===3) return new Date(a.date)-new Date(b.date);
        const keys=["desc","category"]; return a[keys[col]]>b[keys[col]]?1:-1;
    });
    renderTable();
}

function searchExpenses(){
    const query=document.getElementById("search").value.toLowerCase();
    const filtered=expenses.filter(exp=>exp.desc.toLowerCase().includes(query) || exp.category.toLowerCase().includes(query));
    renderFilteredTable(filtered);
}

function renderFilteredTable(filtered){
    const tbody = document.querySelector("#expenseTable tbody");
    tbody.innerHTML="";
    filtered.forEach(item=>{
        const index=expenses.indexOf(item);
        tbody.innerHTML+=`<tr>
            <td>${item.desc}</td>
            <td>${item.category}</td>
            <td>‚Çπ${item.amount.toFixed(2)}</td>
            <td>${item.date}</td>
            <td>
                <button class="edit-btn" onclick="editExpense(${index})">Edit</button>
                <button class="delete-btn" onclick="deleteExpense(${index})">Delete</button>
            </td>
        </tr>`;
    });
}

// ---------------- Chart & Tips ----------------
function renderChart(catTotals){
    const ctx=document.getElementById("expenseChart").getContext("2d");
    if(chartInstance) chartInstance.destroy();
    chartInstance=new Chart(ctx,{
        type:'pie',
        data:{
            labels:Object.keys(catTotals),
            datasets:[{data:Object.values(catTotals),
            backgroundColor:['#a5d6a7','#66bb6a','#388e3c','#00c853','#b9f6ca','#00e676','#1b5e20']}]
        }
    });
}

function checkBudget(total){
    const warning = document.getElementById("budget-warning");
    const status = document.getElementById("budget-status");
    if(budget>0 && total>budget){
        warning.style.display="block";
        warning.innerText="‚ö†Ô∏è Budget Exceeded! Please cut down! This might affect your finances badly, but you can still continue using the tracker.";
        status.innerText=` (Budget: ‚Çπ${budget})`;
    } else {
        warning.style.display="none";
        status.innerText=` (Budget: ‚Çπ${budget})`;
    }
}

function showTip(message){
    const popup=document.createElement("div");
    popup.className="tip-popup";
    popup.innerHTML=`<i class="fas fa-lightbulb" style="color:#ffc107;"></i> ${message}`;
    document.body.appendChild(popup);
    setTimeout(()=>{ popup.remove(); },5000);
}

function smartTips(total, catTotals){
    if((catTotals['Food']||0)/total*100>40) showTip("üçî Food is taking over your budget! Consider cheaper meals.");
    if(budget>0 && total>budget*0.9) showTip("‚ö†Ô∏è You're close to your monthly budget! Track carefully.");
    Object.keys(catTotals).forEach(cat=>{
        if(!['Food','Transport','Books','Leisure'].includes(cat)){
            if(catTotals[cat]/total*100>30) showTip(`üí° ${cat} is taking over your budget! Consider saving money.`);
        }
    });
}
// ---------------- Hardcoded Expense AI responses ----------------
const aiResponses = {
    "food": ["Try cooking at home to save money.", "Consider cheaper meals or discounts.", "Avoid expensive takeaways frequently."],
    "transport": ["Use public transport or carpool to reduce costs.", "Check for student travel passes.", "Walking or cycling saves money and is healthy."],
    "books": ["Buy used books or digital copies.", "Check if your library has the materials.", "Consider renting textbooks instead of buying."],
    "leisure": ["Look for free or low-cost entertainment options.", "Avoid impulsive online subscriptions.", "Plan leisure activities in advance."],
    "others": ["Review these expenses carefully.", "Avoid unnecessary purchases.", "Track miscellaneous expenses to identify patterns."]
};

function expenseAI() {
    if (expenses.length === 0) return;
    const last = expenses[expenses.length - 1];
    let catKey = last.category.toLowerCase();
    if (!aiResponses[catKey]) catKey = "others";
    const responses = aiResponses[catKey];
    const response = responses[Math.floor(Math.random() * responses.length)];
    showTip(`ü§ñ Expense AI: ${response}`);
}

// Call AI every time a new expense is added
const originalAddExpense = addExpense;
addExpense = async function() {
    await originalAddExpense();
    expenseAI();
};

// Optional: call AI on page load for existing expenses
if (expenses.length > 0) expenseAI();
</script>


<footer>
2025 Student Budget Buddy | Made for students üí∏ Contact us at studentbudgetbuddyhelp@gmail.com
</footer>



</body>
</html>


